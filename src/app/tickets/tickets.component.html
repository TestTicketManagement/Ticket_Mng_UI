
<div class="d-flex justify-content-center align-items-center mt-3 ">
    <div class="w-50">
      <input 
      type="text" 
      class="form-control" 
      placeholder="Filter tickets" 
      [(ngModel)]="searchTerm" 
      (input)="filterTickets()" 
    >
    </div>
  </div>

<div class="d-flex justify-content-center mt-3">

<table class="table table-striped w-75">
	<thead>
		<tr>
			<th scope="col">Ticket Id</th>
			<th scope="col">Designation</th>
            <th scope="col">Status</th>
			<th scope="col">Date</th>
            <th scope="col">Action</th>
		</tr>
	</thead>
	<tbody>
		 
			<tr *ngFor="let ticket of filteredTickets | paginate: { itemsPerPage: 5, currentPage: page } " >
				<td>{{ ticket.id }} </td>
				<td>{{ ticket.description }}</td>
                <td>{{ ticket.status }}</td>
				<td>{{ ticket.creationDate }}</td>
                <td>
                    <a  (click)="openUpdateTicketModal(ticket)"  class="link-primary m-2">Update</a>
                    <a  (click)="confirmDeleteTicket(ticket.id)"  class="link-danger">Delete</a>
                </td>
			</tr>
	</tbody>
    <div class="d-flex justify-content-between align-items-center w-75 mt-2 ">
        <button (click)="openAddTicketModal()"  class="btn btn-success">Add Ticket</button> 

        <pagination-controls (pageChange)="page = $event"></pagination-controls>
    </div>
        
    
</table>

</div>

<ng-template #ticketModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">{{ isUpdate ? 'Update Ticket' : 'Add Ticket' }}</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="TicketForm" *ngIf="selectedTicket" >
        <div class="mb-3">
          <label for="id" class="form-label">Ticket ID</label>
          <input type="number" id="id" class="form-control"  formControlName="ticketId"  name="id" [readonly]="isUpdate">
          <div *ngIf="TicketId?.invalid && (TicketId?.dirty || TicketId?.touched)" class="text-danger">
            <div *ngIf="TicketId?.errors?.['required']">This field is required.</div>
            <div *ngIf="TicketId?.errors?.['pattern']">Please enter a valid number.</div>
          </div>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Designation</label>
          <input type="text" id="description" class="form-control"  formControlName="description" name="description" required>
          <div *ngIf="Description?.invalid && (Description?.dirty || Description?.touched)" class="text-danger">
            <div *ngIf="Description?.errors?.['required']">This field is required.</div>
            <div *ngIf="Description?.errors?.['minlength']">Please enter long description.</div>
          </div>
        </div>
        <div class="mb-3">
          <label for="status" class="form-label">Status</label>
          <select id="status" class="form-select" formControlName="status"   name="status" required>
            <option [ngValue]=0>Open</option>
            <option [ngValue]=1>Closed</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cross click')"  >Cancel</button>
          <button type="button" class="btn btn-primary"  [disabled]="TicketForm.invalid" (click)="isUpdate ? updateTicket() : addTicket()"  *ngIf="selectedTicket || !isUpdate" >
            {{ isUpdate ? 'Update' : 'Add' }} 
          </button>
        </div>
      </form>
    </div>
  </ng-template>

